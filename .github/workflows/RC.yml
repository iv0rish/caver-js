name: caver-js rc workflow
on:
  push:
    tags:
      - v*.*.*

jobs:
  workflow_publish:
    name: workflow_publish
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Get git tag version
        id: vars
        run: echo ::set-output name=tag::${GITHUB_REF#refs/*/}

      - name: Verify version between tag and file
        run: |
          echo "tag version is " ${{ steps.vars.outputs.tag }}

          tag_version=$(echo ${{ steps.vars.outputs.tag }} | cut -c -6)
          echo "tag version without rc is " $tag_version

          file_version=v$(${GITHUB_WORKSPACE}/.github/workflows/version.sh)
          echo "file version is " $file_version

          if [ $file_version == $tag_version ]; then
            echo "verification pass"
          else
            echo "It's not same version."
            exit 1
          fi
